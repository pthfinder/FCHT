
namespace = tournament

tournament.99 = {
	hidden = yes

	immediate = {
		remove_list_variable = {
			name = tournament_list
			target = scope:activity.activity_owner
		}
	}
}
# Decide the type of tournament.

tournament.01 = {


	option = { #local
		add_character_flag = holding_tournament

		capital_province = {
			spawn_activity = {
				type = local_tournament
				owner = root
			}
		}
		set_variable = {
			name = num
			value = 1
		}


		every_player = {
			limit = {
				NOT = {
					this = root
				}
				realm_to_title_distance_squared = {
					title = root.primary_title
					value <= 6000
				}
			}
			this = {
				add_to_variable_list = {
					name = tournament_list
					target = root
				}
			}
		}



		ai_chance = {
			base = 0
			modifier = {
				highest_held_title_tier >= tier_county
				add = 10
			}
			modifier = {
				yearly_character_income >= 25
				add = 10
			}
		}
	}

	option = { #regional
		add_character_flag = holding_tournament

		capital_province = {
			spawn_activity = {
				type = regional_tournament
				owner = root
			}
		}
		
		set_variable = {
			name = num
			value = 1
		}


		every_player = {
			limit = {
				NOT = {
					this = root
				}
				realm_to_title_distance_squared = {
					title = root.primary_title
					value <= 8000
				}
			}
			this = {
				add_to_variable_list = {
					name = tournament_list
					target = root
				}
			}
		}



		ai_chance = {
			base = 0
			modifier = {
				highest_held_title_tier >= tier_duchy
				add = 25
			}
			modifier = {
				yearly_character_income >= 50
				add = 10
			}
			modifier = {
				has_trait = humble
				has_trait = fickle
				has_trait = greedy
				add = 10
			}
		}

	}

	option = { #grand
		add_character_flag = holding_tournament

		capital_province = {
			spawn_activity = {
				type = grand_tournament
				owner = root
			}
		}
		set_variable = {
			name = num
			value = 1
		}

		every_player = {
			limit = {
				NOT = {
					this = root
				}
				realm_to_title_distance_squared = {
					title = root.primary_title
					value <= 12000
				}
			}
			this = {
				add_to_variable_list = {
					name = tournament_list
					target = root
				}
			}
		}


		ai_chance = {
			base = 0
			modifier = {
				highest_held_title_tier >= tier_kingdom
				add = 25
			}
			modifier = {
				yearly_character_income >= 100
				add = 10
			}
			modifier = {
				has_trait = ambitious
				has_trait = arrogant
				has_trait = gregarious
				add = 10
			}
		}
	}
}


#  Character receives invitation to join a tournament.
tournament.02 = {
	type = letter_event
	trigger = {
		is_alive = yes
		is_at_war = no
		is_imprisoned = no
		is_incapable = no
		
	}




	option = {
		scope:activity = {
			accept_invitation_for_character = root
		}
		scope:activity.activity_owner = {
			change_variable = {
				name = num
				add = 1
			}
		}

		every_knight = {
			limit = {
				is_knight_of = root
			}
			if = {
				limit = {
				is_ai = yes					
				ai_knight_will_join_with_liege = yes
				}
				scope:activity = {
					invite_character_to_activity = prev
					accept_invitation_for_character = prev
				}
				scope:activity.activity_owner = {
					change_variable = {
						name = num
						add = 1
					}
				}
			}
			else = {
				this = {
					trigger_event = tournament.05
				}

			}
		}

		

		
		remove_character_flag = invited_to_tournament

		ai_chance = {
			base = 50
			modifier = {
				add = 25
				has_trait = brave
				has_trait = gallant
			}
			modifier = {
				is_knight_of = scope:activity.activity_owner
				add = 1000
			}
			modifier = {
				is_vassal_or_below_of = scope:activity.activity_owner
				add = 30

			}
			modifier = {
				root.liege = scope:activity.activity_owner.liege
				add = 10
			}
		}
		
	}
	option = {
		scope:activity = {
			decline_invitation_for_character = root
		}
		remove_character_flag = invited_to_tournament
		ai_chance = {
			base = 0
			modifier = {
				root.highest_held_title_tier > scope:activity.activity_owner.highest_held_title_tier  # Not super prestigious is it?
				add = -50
			}

			modifier = {
				NOT = {
					root.culture_group = scope:activity.activity_owner.culture_group
				}
				add = -10
			}
		}
	}
}

# Event for failed tournament, nobody showed up..
tournament.03 = {
	type = character_event
	title = "tournament failed"
	desc = tournament.03.desc
	theme = crown

	left_portrait = {
		character = scope:activity.activity_owner
		animation = sadness
	}
	immediate = {

		scope:activity = {
			every_participant = {
				remove_character_flag = invited_to_tournament
				remove_character_flag = holding_tournament
			}
		}
		scope:activity = {
			complete_activity = no
		}
		
		every_player = {
			trigger_event = tournament.99
		}
	}

	option = {
		name = tournament.03.option
		stress_impact = {
			base = minor_stress_impact_gain
		}
	}
}

tournament.04 = { # Tournament is about to start, knights have arrived.
	type = character_event
	title = tournament.04.title #all the knights have arrived, throw a feast beforehand.
	desc = tournament.04.desc #triggered desc
	

	left_portrait = {
		character = scope:activity.activity_owner
		animation = happiness
	}

	immediate = {
		if = {
			limit = {
				NOT = {
					has_global_variable = jousting_era
				}
			}
			scope:activity = {
				every_participant = {

					25 = {
						trigger_event = tournament.801

					}


					75 = {
						trigger_event = tournament.800
					}

				}
			}
		}



		every_player = {
			trigger_event = tournament.99
		}
	}

	option = {
		
	}
}


tournament.05 = {
	type = letter_event


	option = {
		scope:activity = {
			invite_character_to_activity = root
			accept_invitation_for_character = root
		}
		scope:activity.activity_owner = {
			change_variable = {
				name = num
				add = 1
			}
		}
	}
	option = {
	}
}


tournament.07 = { #You get drunk and kill someone



	immediate = {
		
		scope:activity = {
			every_participant = {
				limit = {
					is_ai = no
				}
				trigger_event = {
					on_action = tournament_dance_event_selection
					days = 10
				}
			}
		}

	}

	option = {

	}
}
tournament.08 = { # Befriend Feast
	title = tournament.08.title
	desc = tournament.08.desc
	theme = feast_activity

	left_portrait = {
		character = root
		animation = ecstasy
	}
	right_portrait = {
		character = scope:tournament_friend
		animation = ecstasy
	}

	trigger = {
		scope:activity = {
			any_participant = {
				is_ai = yes
				NOR = {
					has_relation_friend = root
					has_relation_best_friend = root
					has_relation_lover = root
					has_relation_soldier_friend = root
					has_relation_nemesis = root
					has_relation_rival = root			
				}
				number_of_personality_traits_in_common = {
					target = root
					value >0
				}
			}
		}
	}

	immediate = {
		play_music_cue = "mx_cue_low_key_positive"
		scope:activity = {
			random_participant = {
				limit = {
					is_ai = yes
					NOR = {
						has_relation_friend = root
						has_relation_best_friend = root
						has_relation_lover = root
						has_relation_soldier_friend = root
						has_relation_nemesis = root
						has_relation_rival = root			
					}
					number_of_personality_traits_in_common = {
						target = root
						value >0
					}
				}
				save_scope_as = tournament_friend
			}
		}


				trigger_event = {
					on_action = tournament_dance_event_selection
					days = 10
				}
			
		
		




	}

	option = {
		name = tournament.08.option.a
		set_relation_friend = scope:tournament_friend

		ai_chance = {
			base = 0
		}

	}
	option = { # Arrogant Nobleman refuses to be friends with a lowborn, even if they are a knight.
	name = tournament.08.option.b
		trigger = {
			AND = {
				root = {
					AND = {
						is_lowborn = no
						has_trait = arrogant
					}
				}
				scope:tournament_friend = {
					is_lowborn = yes
				}
			}

		}
		ai_chance = {
			base = 100
		}
	}
}
tournament.09 = { # Rival Feast
	title = tournament.08.title
	desc = tournament.08.desc
	theme = feast_activity

	left_portrait = {
		character = root
		animation = anger
	}
	right_portrait = {
		character = scope:tournament_rival
		animation = anger
		# triggered_animation = {
		# 	trigger = {

		# 	}

		# }
	}

	theme = feast_activity


	trigger = {
		scope:activity = {
			any_participant = {
				is_ai = yes
				NOR = {
					has_relation_friend = root
					has_relation_best_friend = root
					has_relation_lover = root
					has_relation_soldier_friend = root
					has_relation_nemesis = root
					has_relation_rival = root			
				}
				number_of_opposing_personality_traits = {
					target = root
					value >0
				}
			}
			
		}

	}

	immediate = {
		
		play_music_cue = "mx_cue_negative"
		
		scope:activity = {
			random_participant = {
				limit = {
					is_ai = yes
					NOR = {
						has_relation_friend = root
						has_relation_best_friend = root
						has_relation_lover = root
						has_relation_soldier_friend = root
						has_relation_nemesis = root
						has_relation_rival = root			
					}
					number_of_opposing_personality_traits = {
						target = root
						value >0
					}
				}
				save_scope_as = tournament_rival
			}
		}




		trigger_event = {
			on_action = tournament_dance_event_selection
			days = 10
		}
	}

	option = {

	}
}
tournament.10 = { #Regular Feast
	title = tournament.10
	desc = tournament.10
	theme = feast_activity



	immediate = {

		




		trigger_event = {
			on_action = tournament_dance_event_selection
			days = 10
		}
	}

	option = {

	}
}
tournament.11 = { # Awful Dance

	left_portrait = {
		character = root
		animation = shame
	}
	right_portrait = {
		character = scope:courtier
		animation = disapproval
	}
	theme = mental_break


	override_background = {
		event_background = sitting_room
	}

	immediate = {
		

		play_music_cue = " mx_cue_stress"

		every_courtier_or_guest	= {
			if = {
				limit = {
					root = {
						has_sexuality = heterosexual
					}
					sex_opposite_of	= root		
				}
				save_scope_as = courtier
			}
			else_if = {
				limit = {
					root = {
						has_sexuality = homosexual
					}
					sex_same_as	= root		
				}
				save_scope_as = courtier
			}
			else_if = {
				limit = {
					root = {
						OR = {
							has_sexuality = bisexual
							has_sexuality = asexual
						}
					}
				}
				save_scope_as = courtier
			}
		}

	}

	option = {

	}
}
tournament.12 = { # Inspiring Dance
	title = tournament.12.title
	desc = tournament.12.desc

	left_portrait = {
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:courtier
		animation = love
	}
	theme = love
	override_background = {
		event_background = sitting_room
	}


	immediate = {
		play_music_cue = "mx_cue_marriage"

		every_courtier_or_guest	= {
			if = {
				limit = {
					root = {
						has_sexuality = heterosexual
					}
					sex_opposite_of	= root		
				}
				save_scope_as = courtier
			}
			else_if = {
				limit = {
					root = {
						has_sexuality = homosexual
					}
					sex_same_as	= root		
				}
				save_scope_as = courtier
			}
			else_if = {
				limit = {
					root = {
						OR = {
							has_sexuality = bisexual
							has_sexuality = asexual
						}
					}
				}
				save_scope_as = courtier
			}
		}

	}

	option = {
		name = tournament.12.option.a

	}
}
tournament.13 = { # Regular Dance

	left_portrait = {
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:courtier
		animation = happiness

	}

	theme = friendly


	override_background = {
		event_background = sitting_room
	}

	immediate = {

		play_music_cue = "mx_cue_banquet"

		every_courtier_or_guest	= {
			if = {
				limit = {
					root = {
						has_sexuality = heterosexual
					}
					sex_opposite_of	= root		
				}
				save_scope_as = courtier
			}
			else_if = {
				limit = {
					root = {
						has_sexuality = homosexual
					}
					sex_same_as	= root		
				}
				save_scope_as = courtier
			}
			else_if = {
				limit = {
					root = {
						OR = {
							has_sexuality = bisexual
							has_sexuality = asexual
						}
					}
				}
				save_scope_as = courtier
			}
		}

	}

	option = {

	}
}

#Kingdoms can license tournaments,making them occur more frequently, be larger in size. But perhaps makes factions occur more easily, or gives a scheme debuff.
#Kingdoms can prohibti tournaments, tournaments can still be held but at a risk to the character. It gives a stability bonus to the realm perhaps but you lose the potential prowess buffs for your knights.
#Pope can issue bulls about tournaments, which gives those who join a chance of beign excommunicated.
#Mid to late 1200s, Jousts appear.
#Behourds, Roundstables, Melees



#Types of tournament

#There was a very wide range, can classify them into tthree types
#Original mass tournament, the melee proper, fought between two teams of knights either in the open field or in the lists, the field tournament without enclosing barriers in the 12th century does not seem to have survived beyond the 13th century.
#The mass tournament, gives way in the late 14th century to the individual gjoust, whcih first appears in the late 12th century, but only reaches its most developed form with the tilt down the centre of the lists in the early 15th century.
#Practice tournament,


#Reasons for holding tournaments
#Held because the participants enjoyed them
#Held during sieges. (not good for gameplay, maybe a flavor event.
#End of campaign could be marked by jousts or tournaments.
#Knighting ceremonies
#Coronations
#Diplomatic Meetings
#Weddings
#Prizes were generally items, can abstract to gold.


#Wake up on the day of the event, town background



tournament.0100 = {
	title = "Morning Before"
	desc = ""

	override_background = {
		event_background = market_west
	}

	immediate = {
	}
	option = {

	}
}

#About to begin the melee, grassland background

tournament.0101 = {
	title = "The Tournament Begins!"
	desc = ""

	override_background = {
		event_background = farmland
	}
	immediate = {
		play_music_cue = "mx_cue_war_declared"


		set_variable = {
			name = number_of_captures
			value = 0
		}
		set_variable = {
			name = number_of_times_captured
			value = 0
		}
		set_variable = { 
			name = gold_earned
			value = 0
		}
		set_variable = {
			name = event_counter
			value = 1
		}
		trigger_event = {
			on_action = tournament_actual_event_selection
			days = 5
		}
		trigger_event = {
			on_action = tournament_actual_event_selection
			days = 15
		}
		trigger_event = {
			on_action = tournament_actual_event_selection 
			days = 25
		}

	}
	option = {

	}
}

tournament.0800 = { #You were unhorsed and captured
	title = ""
	desc = ""

	left_portrait = {
		character = scope:opponent
		animation = personality_bold
	}
	right_portrait = {
		character = root
		animation = shame
	}

	trigger = {
		scope:activity = {
			any_participant = {
				is_alive = yes
				prowess > root.prowess
				
			}
		}
	}

	override_background = {
		event_background = farmland
	
	}

	immediate = {
		scope:activity = {
			random_participant = {
				limit = {
					is_alive = yes
					prowess > root.prowess
				}
				save_scope_as = opponent
			}
		}



		if = {
			limit = {
				is_landed = no
			}
			change_variable = {
				name = gold_earned
				subtract = 10
			}

			scope:opponent = {
				change_variable = {
					name = gold_earned
					add = 10
				}
			}

		}
		else_if = {
			limit = {
				root.highest_held_title_tier = tier_barony
			}
			root = {
				change_variable = {
					name = gold_earned
					subtract = 20
				}
			}

			scope:opponent = {
				change_variable = {
					name = gold_earned
					add = 20
				}
			}

		}

		else_if = {
			limit = {
				root.highest_held_title_tier = tier_county
			}
			root = {
				change_variable = {
					name = gold_earned
					subtract = 30
				}
			}

			scope:opponent = {
				change_variable = {
					name = gold_earned
					add = 30
				}
			}

		}
		else_if = {
			limit = {
				root.highest_held_title_tier = tier_duchy
			}
			root = {
				change_variable = {
					name = gold_earned
					subtract = 50
				}
			}
			scope:opponent = {
				change_variable = {
					name = gold_earned
					add = 50
				}
			}
		}
		else_if = {
			limit = {
				root.highest_held_title_tier = tier_kingdom
			}
			root = {
				change_variable = {
					name = gold_earned
					subtract = 75
				}
			}

			scope:opponent = {
				change_variable = {
					name = gold_earned
					add = 75
				}
			}
		}
		else_if = {
			limit = {
				root.highest_held_title_tier = tier_empire
			}
			root = {
				change_variable = {
					name = gold_earned
					subtract = 100
				}
			}

			scope:opponent = {
				change_variable = {
					name = gold_earned
					add = 100
				}
			}
			
		}


		scope:opponent = {
			change_variable = {
				name = number_of_captures
				add = 1
			}
		}
		root = {
			change_variable = {
				name = number_of_times_captured
				add = 1
			}
		}

		



	}
	option = {
		name = "Watch out for me next time, ____!"


	}
}
tournament.0801 = { #You unhorsed someone and captured them
	title = ""
	desc = ""

	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:opponent
		animation = shame
	}

	override_background = {
		event_background = terrain_activity

	}
	trigger = {
		scope:activity = {
			any_participant = {
				is_alive = yes
				prowess < root.prowess
				
			}
		}
	}


	immediate = {
		scope:activity = {
			random_participant = {
				limit = {
					is_alive = yes
					prowess < root.prowess
				}
				save_scope_as = opponent
			}
		}

		if = {
			limit = {
				scope:opponent = {
					is_landed = no
				}
			}
			root = {
				change_variable = {
					name = gold_earned
					add = 10
				}
			}
			scope:opponent = {
				change_variable = {
					name = gold_earned
					subtract = 10
				}
			}

		}
		else_if = {
			limit = {
				scope:opponent.highest_held_title_tier = tier_barony
			}
			root = {
				change_variable = {
					name = gold_earned
					add = 20
				}
			}

			scope:opponent = {
				change_variable = {
					name = gold_earned
					subtract = 20
				}
			}

		}

		else_if = {
			limit = {
				scope:opponent.highest_held_title_tier = tier_county
			}
			root = {
				change_variable = {
					name = gold_earned
					add = 30
				}
			}

			scope:opponent = {
				change_variable = {
					name = gold_earned
					subtract = 30
				}
			}

		}
		else_if = {
			limit = {
				scope:opponent.highest_held_title_tier = tier_duchy
			}
			root = {
				change_variable = {
					name = gold_earned
					add = 50
				}
			}

			scope:opponent = {
				change_variable = {
					name = gold_earned
					subtract = 50
				}
			}
		}
		else_if = {
			limit = {
				scope:opponent.highest_held_title_tier = tier_kingdom
			}
			root = {
				change_variable = {
					name = gold_earned
					add = 75
				}
			}

			scope:opponent = {
				change_variable = {
					name = gold_earned
					subtract = 75
				}
			}
		}
		else_if = {
			limit = {
				scope:opponent.highest_held_title_tier = tier_empire
			}
			root = {
				change_variable = {
					name = gold_earned
					add = 100
				}
			}


			scope:opponent = {
				change_variable = {
					name = gold_earned
					subtract = 100
				}
			}
			
		}
		root = {
			change_variable = {
				name = number_of_captures
				add = 1
			}
		}

		scope:opponent = {
			change_variable = {
				name = number_of_times_captured
				add = 1
			}
		}
	}

	option = {
		name = "You fought well ____, but you are now my prisoner for ransom!"
	}










}
tournament.0802 = { #You and another knight team up on someone
	title = ""
	desc = ""


	override_background = {
		event_background = terrain_activity

	}
}
tournament.0803 = { #You are teamed up on
	title = ""
	desc = ""


	override_background = {
		event_background = terrain_activity

	}
}

tournament.0804 = { # You accidently killed someone
	title = ""
	desc = ""


	override_background = {
		event_background = terrain_activity

	}
}

tournament.0805 = { #You were accidently killed 
	title = ""
	desc = ""


	override_background = {
		event_background = terrain_activity

	}
}


tournament.0806 = { #drainage pipe meme event
	title = ""
	desc = ""


	override_background = {
		event_background = terrain_activity

	}
}

tournament.0807 = { #the tournament continues on for many more hours, in the end, you captured and ransomed n knights, were captured n times
	title = ""
	desc = ""


	override_background = {
		event_background = terrain_activity

	}
}






